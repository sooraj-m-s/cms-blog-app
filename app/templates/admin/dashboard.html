<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="/static/admin/css/dashboard.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Admin Dashboard</h1>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('users')">Users Management</button>
            <button class="tab" onclick="switchTab('blogs')">Blogs Management</button>
            <button class="tab" onclick="switchTab('feedbacks')">Feedbacks Management</button>
        </div>

        <!-- Users Tab -->
        <div id="users-tab" class="tab-content active">
            <div class="card">
                <h2 style="margin-bottom: 20px;">Users Management</h2>
                <div class="loading" id="users-loading">
                    <div class="spinner"></div>
                    Loading users...
                </div>
                <div class="table-container">
                    <table id="users-table" style="display: none;">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Status</th>
                                <th>Created At</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="users-tbody"></tbody>
                    </table>
                </div>
                <div class="pagination" id="users-pagination"></div>
            </div>
        </div>

        <!-- Blogs Tab -->
        <div id="blogs-tab" class="tab-content">
            <div class="card">
                <h2 style="margin-bottom: 20px;">Blogs Management</h2>
                <div class="loading" id="blogs-loading">
                    <div class="spinner"></div>
                    Loading blogs...
                </div>
                <div class="table-container">
                    <table id="blogs-table" style="display: none;">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Title</th>
                                <th>Status</th>
                                <th>Created At</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="blogs-tbody"></tbody>
                    </table>
                </div>
                <div class="pagination" id="blogs-pagination"></div>
            </div>
        </div>

        <!-- Feedbacks Tab -->
        <div id="feedbacks-tab" class="tab-content">
            <div class="card">
                <h2 style="margin-bottom: 20px;">Feedbacks Management</h2>
                <div class="search-container">
                    <input type="text" class="search-input" placeholder="Enter Blog ID to view feedbacks..." id="blog-id-input">
                    <button class="btn btn-primary" onclick="loadFeedbacks()" style="margin-left: 10px;">Load Feedbacks</button>
                </div>
                <div class="loading" id="feedbacks-loading">
                    <div class="spinner"></div>
                    Loading feedbacks...
                </div>
                <div class="table-container">
                    <table id="feedbacks-table" style="display: none;">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>User ID</th>
                                <th>Content</th>
                                <th>Status</th>
                                <th>Created At</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="feedbacks-tbody"></tbody>
                    </table>
                </div>
                <div class="pagination" id="feedbacks-pagination"></div>
            </div>
        </div>
    </div>

    <script>
        window.BASE_URL = '{{ base_url }}';
        
        function displayUsers(users) {
            const tbody = document.getElementById('users-tbody');
            tbody.innerHTML = '';

            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.name || 'N/A'}</td>
                    <td>${user.email}</td>
                    <td>
                        <span class="status-badge ${user.is_blocked ? 'status-blocked' : 'status-active'}">
                            ${user.is_blocked ? 'Blocked' : 'Active'}
                        </span>
                    </td>
                    <td>${new Date(user.created_at).toLocaleDateString()}</td>
                    <td>
                        <button class="btn ${user.is_blocked ? 'btn-success' : 'btn-danger'}" 
                                onclick="toggleUserBlock(${user.id}, ${user.is_blocked})">
                            ${user.is_blocked ? 'Unblock' : 'Block'}
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function displayBlogs(blogs) {
            const tbody = document.getElementById('blogs-tbody');
            tbody.innerHTML = '';

            blogs.forEach(blog => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${blog.id}</td>
                    <td>${blog.title.length > 50 ? blog.title.substring(0, 50) + '...' : blog.title}</td>
                    <td>
                        <span class="status-badge ${blog.is_blocked ? 'status-blocked' : 'status-active'}">
                            ${blog.is_blocked ? 'Blocked' : 'Active'}
                        </span>
                    </td>
                    <td>${new Date(blog.created_at).toLocaleDateString()}</td>
                    <td>
                        <button class="btn ${blog.is_blocked ? 'btn-success' : 'btn-danger'}" 
                                onclick="toggleBlogBlock(${blog.id}, ${blog.is_blocked})">
                            ${blog.is_blocked ? 'Unblock' : 'Block'}
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function displayFeedbacks(feedbacks) {
            const tbody = document.getElementById('feedbacks-tbody');
            tbody.innerHTML = '';

            feedbacks.forEach(feedback => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${feedback.id}</td>
                    <td>${feedback.user_id}</td>
                    <td>${feedback.content.length > 100 ? feedback.content.substring(0, 100) + '...' : feedback.content}</td>
                    <td>
                        <span class="status-badge ${feedback.is_listed ? 'status-listed' : 'status-blocked'}">
                            ${feedback.is_listed ? 'Listed' : 'Hidden'}
                        </span>
                    </td>
                    <td>${new Date(feedback.created_at).toLocaleDateString()}</td>
                    <td>
                        <button class="btn ${feedback.is_listed ? 'btn-warning' : 'btn-success'}" 
                                onclick="toggleFeedbackListed(${feedback.id}, ${feedback.is_listed})">
                            ${feedback.is_listed ? 'Hide' : 'Show'}
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function createPagination(containerId, currentPage, totalPages, loadFunction) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            const prevBtn = document.createElement('button');
            prevBtn.textContent = 'Previous';
            prevBtn.disabled = currentPage === 1;
            prevBtn.onclick = () => {
                if (currentPage > 1) {
                    loadFunction(currentPage - 1);
                }
            };
            container.appendChild(prevBtn);

            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);

            if (startPage > 1) {
                const firstBtn = document.createElement('button');
                firstBtn.textContent = '1';
                firstBtn.onclick = () => loadFunction(1);
                container.appendChild(firstBtn);

                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.style.padding = '8px';
                    ellipsis.style.color = 'var(--text-muted)';
                    container.appendChild(ellipsis);
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.textContent = i;
                pageBtn.className = i === currentPage ? 'active' : '';
                pageBtn.onclick = () => loadFunction(i);
                container.appendChild(pageBtn);
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.style.padding = '8px';
                    ellipsis.style.color = 'var(--text-muted)';
                    container.appendChild(ellipsis);
                }

                const lastBtn = document.createElement('button');
                lastBtn.textContent = totalPages;
                lastBtn.onclick = () => loadFunction(totalPages);
                container.appendChild(lastBtn);
            }

            const nextBtn = document.createElement('button');
            nextBtn.textContent = 'Next';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.onclick = () => {
                if (currentPage < totalPages) {
                    loadFunction(currentPage + 1);
                }
            };
            container.appendChild(nextBtn);
        }

        window.displayUsers = displayUsers;
        window.displayBlogs = displayBlogs;
        window.displayFeedbacks = displayFeedbacks;
        window.createPagination = createPagination;
    </script>
    <script src="/static/admin/js/dashboard.js"></script>
</body>
</html>